!function(){"use strict";angular.module("firebase.fuel",["platanus.inflector","firebase.starter"])}(),function(){"use strict";function t(t,n,e){function r(t){switch(angular.isString(t)){case!0:switch(t.length<20){case!0:return t;case!1:return u(t)}case!1:return s(t)}}function i(t){switch(Array.isArray(t)){case!0:return t;case!1:return s(t)}}function o(t){var n=[!1,!0];switch(n.indexOf(t)){case-1:return s(t);default:return t}}function s(t){throw new Error("Invalid parameter type at: "+t)}function u(t){throw new Error("Invalid parameter length at: "+t)}function a(t,n,e){switch(angular.isUndefined(t)){case!0:return e;case!1:switch(n){case"bool":return o(t);case"str":return r(t);case"arr":return i(t);case"opt":return c(t)}}}function c(t){return t}function h(t,n){return e.camelize(t,n)}function f(t){return e.singularize(t)}function _(t){return e.pluralize(t)}function l(t){return n.when(t)}function d(t,e){return n.all([t,l(e)])}function p(n){return n.length?(t.info("flattening results"),y(n)):n}function g(t){return n.reject(t)}function m(t){return b(w(v(t)))}function v(t){return"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),"/"===t[0]&&(t=t.substring(1)),t}function y(t){var n=t.reduce(function(t,n){return t.concat(n)},[]);return n}function w(t){return Array.isArray(t)?y(t):j([],t)}function b(t){return Array.isArray(t)&&(t=t.join("/")),t}function j(t,n){t.push(n),t=y(t);var e=t.indexOf(void 0);return e>-1&&t.splice(e,1),t}function $(t,n){return t=v(t).slice(v(n).length),t=t.split("/"),""===t[0]&&t.shift(),t}function k(t,n){var e=[],r=[];return n.forEach(function(n,i){n===t[i]?e.push(n):r.push(n)}),r.length>0&&(r=b(r)),r}function S(t,n){return t=w(t),t[0]===n&&t.shift(),t}var M={toArray:w,camelize:h,extendPath:j,flatten:y,removeSlash:v,stringify:b,pluralize:_,relativePath:m,qWrap:l,qAll:d,qAllResult:p,singularize:f,paramCheck:a,paramNodeIdx:S,nodeIdx:$,nextPath:k,standardError:g};return M}angular.module("firebase.fuel").factory("utils",t),t.$inject=["$log","$q","inflector"]}(),function(){"use strict";function t(t){function n(n){t.info(n)}return{info:n}}t.$inject=["$log"],angular.module("firebase.fuel").factory("logger",t)}(),function(){"use strict";function t(t){t.debugEnabled(!0)}angular.module("firebase.fuel").config(t),t.$inject=["$logProvider"]}(),function(){"use strict";function t(t,e,r,i,o,s){return function(u,a){var c=new n(t,e,r,i,o,s,u,a);return c.construct()}}var n;angular.module("firebase.fuel").factory("fuel",t),t.$inject=["$timeout","utils","firePath","$q","$log","$injector"],n=function(t,n,e,r,i,o,s,u){this._timeout=t,this._utils=n,this._firePath=e,this._q=r,this._log=i,this._injector=o,this._path=s,this._options=this._utils.paramCheck(u,"opt",{}),this._pathOptions={},this._constant=this._utils.paramCheck(this._options.constant,"str","FBURL"),this._geofire=this._utils.paramCheck(this._options.geofire,"bool",!1),this._gps=this._utils.paramCheck(this._options.gps,"bool",!1),this._nestedArrays=this._utils.paramCheck(this._options.nestedArrays,"arr",[]),this._session=this._utils.paramCheck(this._options.session,"bool",!1),this._user=this._utils.paramCheck(this._options.user,"bool",!1),(this._gps===!0||this._geofire===!0)&&(this._locationNode=this._utils.paramCheck(this._options.locationNode,"str","locations"),this._geofireNode=this._utils.paramCheck(this._options.geofireNode,"str","geofire"),this._latitude=this._utils.paramCheck(this._options.latitude,"str","lat"),this._longitude=this._utils.paramCheck(this._options.longitude,"str","lon"),this._pathOptions.geofire=!0,this._pathOptions.locationNode=this._locationNode,this._pathOptions.geofireNode=this._geofireNode),this._gps===!0&&(this._locationService=this._utils.paramCheck(this._options.locationService,"str",this._utils.singularize(this._locationNode)),this._geofireService=this._utils.paramCheck(this._options.geofireService,"str","geofire"),this._locationObject=this._injector.get(this._locationService),this._geofireObject=this._injector.get(this._geofireService)),(this._user===!0||this._session===!0)&&(this._uid=this._utils.paramCheck(this._options.uid,"bool",!0),this._uidProperty=this._utils.paramCheck(this._options.uidProperty,"str","uid")),this._user===!0&&(this._userNode=this._utils.paramCheck(this._options.userNode,"str","users"),this._userService=this._utils.paramCheck(this._options.userService,"str",this._utils.singularize(this._userNode)),this._userObject=this._injector.get(this._userService),this._session=!0),this._session===!0&&(this._sessionService=this._utils.paramCheck(this._options.sessionService,"str","session"),this._sessionIdMethod=this._utils.paramCheck(this._options.sessionIdMethod,"str","getId"),this._sessionObject=this._injector.get(this._sessionService),this._pathOptions.session=!0,this._pathOptions.sessionService=this._sessionService,this._pathOptions.sessionIdMethod=this._sessionIdMethod),this._pathMaster=this._firePath(this._path,this._pathOptions,this._constant)},n.prototype={construct:function(){function t(){return at._pathMaster.path()}function n(){return at._pathMaster.ref()}function e(){return at._pathMaster.parent()}function r(){return at._pathMaster.base()}function i(){return at._pathMaster.pathHistory()}function o(){return at._pathMaster.mainArray()}function s(t){return at._pathMaster.mainRecord(t)}function u(t,n){return at._pathMaster.nestedArray(t,n)}function a(t,n){return at._pathMaster.nestedRef(t,n)}function c(t,n,e){return at._pathMaster.indexAf(t,n,e)}function h(t,n,e){return at._pathMaster.nestedRecord(t,n,e)}function f(t){return at._pathMaster.makeGeo(t)}function _(t){return angular.isUndefined(t)?l():d(t)}function l(){return o().then(X).then(it)["catch"](st)}function d(t){return s(t).then(X).then(it)["catch"](st)}function p(){function t(t){return at._q.all(t.map(function(t){return _(t)}))}return at._userObject.getIndexKeys(z(),at._path).then(t)["catch"](st)}function g(t){return ot(l(),t).then(Q).then(it)["catch"](st)}function m(t,n,e){switch(angular.isString(t)){case!0:return ot(s(t),[n,e]).then(V)["catch"](st);case!1:return ot(t,[n,e]).then(V)["catch"](st)}}function v(t,n,e){return e===!0&&(t[at._uidProperty]=z()),ot(o(),t).then(D).then(rt)["catch"](st)}function y(t){function n(n){return angular.isString(n)?s(t).then(G):G(t)}return n(t).then(rt)["catch"](st)}function w(t){return K(t).then(rt)["catch"](st)}function b(t,n){return at._geofireObject.set(at._path,t,n)}function j(t){return at._geofireObject.remove(at._path,t)}function $(t,n){return h(t,n).then(G).then(rt)["catch"](st)}function k(t,n,e){return e===!0&&(delete n[at._latitude],delete n[at._longitude]),ot(u(t),n).then(D).then(rt)["catch"](st)}function S(t,n,e){function r(t){return t[0].set(t[1][0],t[1][1])}return ot(f(t),[n,e]).then(r).then(rt)["catch"](st)}function M(t,n){function e(t){return ot(t[0],t[0].query(t[1]))}return ot(f(t),n).then(e).then(it)["catch"](st)}function C(t,n){function e(t){return ot(t[0],t[0].get(t[1]))}return ot(f(t),n).then(e).then(it)["catch"](st)}function A(t,n){function e(t){return at._log.info(t),t[0].remove(t[1])}return ot(f(t),n).then(e).then(rt)["catch"](st)}function O(t){function n(t){return ot(b(t[0].key(),t[1]),t[0])}var e={lat:t[at._latitude],lon:t[at._longitude]};return ot(at._locationObject.addLoc(at._path,t,!0),[e.lat,e.lon]).then(n)["catch"](st)}function x(t){function n(t){return ot(j(t.key()),t)}return at._locationObject.removeLoc(t).then(n)["catch"](st)}function I(t){return at._userObject.addIndex(z(),at._path,t)}function R(t){return at._userObject.removeIndex(z(),at._path,t)}function q(t,n){return m(z(),t,n)}function N(){return s(z())}function P(){return at._sessionObject}function z(){return at._sessionObject[at._sessionIdMethod]()}function E(t,n,e){function r(t){return ot(I(t.key()),t)}return e||(e=at._uid),v(t,n,e).then(r)["catch"](st)}function B(t){function n(t){return ot(R(t.key()),t)}return y(t).then(n)["catch"](st)}function L(t,n){function e(t){return ot(Z(t[0].key(),at._locationNode,t[1][1].key()),t[0])}function r(t){return t[1]}return at._q.all([v(t),O(n,!0)]).then(e).then(r).then(rt)["catch"](st)}function U(t){function n(t){function n(t){return at._q.all(t.map(function(t){return x(t)}))}return nt(t,at._locationNode).then(n)}function e(t){return y(t[1])}return ot(n(t),t).then(e)["catch"](st)}function F(t,n){function e(t){return ot(Z(t[0][1].key(),at._locationNode,t[1][1].key()),t[0][1])}function r(t){return t[1]}return at._q.all([E(t),O(n,!0)]).then(e).then(r).then(rt)["catch"](st)}function H(t){function n(t){function n(t){return at._q.all(t.map(function(t){return x(t)}))}return nt(t,at._locationNode).then(n)}function e(t){return B(t[1])}return ot(n(t),t).then(e)["catch"](st)}function Y(t,n){var e={};return at._q.all(n.map(function(n){angular.extend(e,T(t,n))})),angular.merge({},t,e)}function T(t,n){var e,r,i,o,s,a,c,f,_;return e=at._utils.pluralize(n),r=at._utils.singularize(n),i="add"+at._utils.camelize(r,!0),o="get"+at._utils.camelize(r,!0),s="remove"+at._utils.camelize(r,!0),a="load"+at._utils.camelize(r,!0),c="load"+at._utils.camelize(e,!0),f="save"+at._utils.camelize(r,!0),_={},_[e]=function(t){return at._session!==!0||t||(t=z()),u(t,e)},_[r]=function(t,n){if(at._session!==!0||n||(n=z()),t)return h(n,e,t);throw new Error("You must provide a record id")},_[i]=function(t,n){return ot(_[e](n),t).then(D).then(rt)["catch"](st)},_[o]=function(t,n){return ot(_[e](n),t).then(Q).then(it)["catch"](st)},_[s]=function(t,n){return _[r](t,n).then(G).then(rt)["catch"](st)},_[a]=function(t,n){return _[r](t,n).then(X).then(it)["catch"](st)},_[c]=function(t){return _[e](t).then(X).then(it)["catch"](st)},_[f]=function(t){return w(t)},_}function D(t){return t[0].$add(t[1])}function G(t){return Array.isArray(t)?t[0].$remove(t[1]):t.$remove()}function K(t){switch(Array.isArray(t)){case!0:return W(t);case!1:return J(t)}}function W(t){function n(n){switch(angular.isString(n[1])){case!0:return ot(n[0].$indexFor(n[1]),n[0]).then(e);case!1:return t[0].$save(t[1])}}function e(t){return t[1].$save(t[0])}return n(t)["catch"](st)}function J(t){return t.$save()}function Q(t){function n(t){return[t[1],t[0]]}return ot(t[0].$getRecord(t[1]),t[0]).then(n)["catch"](st)}function V(t){return t[0].$bindTo(t[1][0],t[1][1])}function X(t){return t.$loaded()}function Z(t,n,e){function r(t){return at._timeout(function(){var n={};return n[t[1]]=!0,t[0].update(n)}).then(function(){return t[0]})["catch"](st)}return ot(a(t,n),e).then(r)["catch"](st)}function tt(t,n,e){function r(t){return at._timeout(function(){var n={};return n[t[1]]=null,t[0].update(n)}).then(function(){return t[0]})["catch"](st)}return ot(a(t,n),e).then(r)["catch"](st)}function nt(t,n){function e(t){return ot(t.$loaded(),[])}function r(t){return at._q.all(t[0].map(function(n){t[1].push(n.$id)})),t[1]}return c(t,n,"array").then(e).then(r)["catch"](st)}function et(){function t(t){return t.orderByChild("uid").once("value",function(t){return t.val()})}return at._timeout(function(){return at._pathMaster.mainRef().then(t)["catch"](st)})}function rt(t){switch(at._log.info("command success"),angular.isString(t.key())){case!0:return at._pathMaster.setCurrentRef(t),t;default:throw at._log.info(t),new Error("invalid command success")}}function it(t){switch(at._log.info("query success"),angular.isDefined(t.$ref)){case!0:return at._log.info("setting ref to current object ref"),at._pathMaster.setCurrentRef(t.$ref()),at._pathMaster.setBase(t),t;case!1:switch(angular.isObject(t[1])){case!0:return at._log.info(t),at._log.info("setting ref to current parent"),at._pathMaster.setCurrentRef(t[0].$ref()),at._pathMaster.setBase(t[0]),t[1];case!1:return at._log.info("return value is null"),at._pathMaster.setCurrentRef(t[0].$ref()),at._pathMaster.setBase(t[0]),t[0]}default:throw at._log.info(t),new Error("invalid query success")}}function ot(t,n){return at._utils.qAll(t,n)}function st(t){return at._utils.standardError(t)}function ut(t){return t?(t="_"+t,at[t]):at}var at=this,ct={};switch(ct.base=r,ct.ref=n,ct.path=t,ct.parent=e,ct.pathHistory=i,ct.inspect=ut,ct.load=_,ct.getRecord=g,ct.getIndexKeys=nt,ct.bindTo=m,ct.save=w,ct.addIndex=Z,ct.removeIndex=tt,at._user!==!0&&at._gps!==!0&&(ct.add=v,ct.remove=y),at._user===!0&&(ct.loadUserRecords=p,ct.userRecordsByUID=et),at._gps===!0&&(ct.createLocation=O,ct.removeLocation=x),at._user!==!0&&at._gps===!0&&(ct.add=L,ct.remove=U),at._user===!0&&at._gps!==!0&&(ct.add=E,ct.remove=B),at._user===!0&&at._gps===!0&&(ct.add=F,ct.remove=H),at._session===!0&&(ct.bindCurrent=q,ct.current=N,ct.session=P,ct.sessionId=z),at._geofire===!0&&(ct.get=C,ct.remove=A,ct.set=S,ct.query=M,ct.addLoc=k,ct.removeLoc=$),n(),at._nestedArrays){case[]:break;default:return Y(ct,at._nestedArrays)}return at._entity=ct,at._entity}}}.call(this),function(){"use strict";function t(t,e,r,i,o,s){return function(u,a,c){var h=new n(t,e,r,i,o,s,u,a,c);return h.construct()}}var n;angular.module("firebase.fuel").factory("firePath",t),t.$inject=["utils","$window","$q","$log","$injector","fireStarter"],n=function(t,n,e,r,i,o,s,u,a){if(this._utils=t,this._window=n,this._q=e,this._log=r,this._injector=i,this._path=s,this._fireStarter=o,this._options=u||null,this._constant=a||"FBURL",this._rootPath=this._injector.get(this._constant),!angular.isString(this._rootPath))throw new Error("You must provide a root path, either by a constant 'FBURL' or by providing a service name to inject");if(this._const=void 0,"FBURL"!==this._constant&&(this._const=this._constant),this._session=!1,this._geofire=!1,this._options){if(this._options.session===!0){if(this._session=!0,!this._options.sessionService)throw new Error("You must provide a service to inject to access your session");if(this._sessionObject=this._injector.get(this._options.sessionService),!this._options.sessionIdMethod)throw new Error("You must provide a method to query the sessionId");this._sessionIdMethod=this._options.sessionIdMethod}this._options.geofire===!0&&(this._geofire=!0,this._locationNode=this._options.locationNode||"locations",this._geofireNode=this._options.geofireNode||"geofire")}},n.prototype={construct:function(){function t(t,r){switch(n(t)){case!1:throw new Error("You cannot switch to a new main node");case!0:switch(r){case void 0:return e(t);default:return i(r,e(t),!0)}}}function n(t){return N(t).search(p())>-1}function e(t){var n;switch(q(t)<0){case!0:n=S(b().child(I(t)));case!1:n=S(r(q(t)))}return n}function r(t){var n=b();switch(z._log.info("setting parent at index: "+t),t){case 0:return n;case 1:return n.parent();case 2:return n.parent().parent();case 3:return n.parent().parent().parent();case 4:return n.parent().parent().parent().parent();case 5:return n.parent().parent().parent().parent().parent();default:throw new Error("Too deep - construct again")}}function i(t,n,e){function r(t){return k(t),t}return z._q.when(z._fireStarter(t,n,e,z._const)).then(r)["catch"](A)}function o(){return new z._window.Firebase(d())}function s(){return o().child(z._utils.relativePath(z._path))}function u(n,e){return t(v(n,e))}function a(){return t(z._path,"array")}function c(n){return t(m(n),"object")}function h(n,e){return t(v(n,e),"array")}function f(n,e,r){return t(y(n,e,r),"object")}function _(n,e,r){return t(v(n,e),r)}function l(n){return t(z._utils.toArray([z._path,n]),"geo")}function d(){return z._utils.removeSlash(z._rootPath)}function p(){return s().toString()}function g(){return z._utils.toArray(z._path)}function m(t){return z._utils.extendPath(g(),t)}function v(t,n){return z._utils.extendPath(m(t),n)}function y(t,n,e){return z._utils.extendPath(v(t,n),e)}function w(){return b()?b().toString():void 0}function b(){return E._ref}function j(){return E._ref.parent()}function $(){return E._base}function k(t){return E._base=t,E._base}function S(t,n){return E._ref=t,M(t.toString()),n===!0&&k(null),E._ref}function M(t){return angular.isString(E._path)&&C(E._path),E._path=t,E._path}function C(t){E._pathHistory.push(t)}function A(t){return z._utils.standardError(t)}function O(){return E._pathHistory}function x(){return z._utils.nodeIdx(w(),p())}function I(t){return z._utils.nextPath(x(),R(t))}function R(t){return z._utils.paramNodeIdx(t,z._path)}function q(t){return x().length-R(t).length}function N(t){return z._utils.stringify([d(),z._utils.relativePath(t)])}function P(){return z}var z=this,E={};return E.main=s,E.nestedRef=u,E.rootRef=o,E.mainArray=a,E.mainRecord=c,E.nestedArray=h,E.nestedRecord=f,E.indexAf=_,E.build=t,E._pathHistory=[],E.base=$,E.setBase=k,E.ref=b,E.path=w,E.parent=j,E.pathHistory=O,E.nextRef=e,E.setCurrentRef=S,E.inspect=P,z._geofire===!0&&(E.makeGeo=l),S(s()),z._fire=E,z._fire}}}.call(this);