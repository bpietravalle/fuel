!function(){"use strict";angular.module("firebase.fuel",["platanus.inflector","firebase.starter"])}(),function(){"use strict";function t(t,n,e){function r(t,n){return e.camelize(t,n)}function i(t){return e.singularize(t)}function o(t){return e.pluralize(t)}function s(t){return n.when(t)}function u(t,e){return n.all([t,s(e)])}function a(n){return n.length?(t.info("flattening results"),_(n)):n}function c(t){return n.reject(t)}function h(t){return d(l(f(t)))}function f(t){return"/"===t[-1]&&(t=t.substring(0,-1)),"/"===t[0]&&(t=t.substring(1)),t}function _(t){var n=t.reduce(function(t,n){return t.concat(n)},[]);return n}function l(t){return Array.isArray(t)?_(t):p([],t)}function d(t){return Array.isArray(t)&&(t=t.join("/")),t}function p(t,n){t.push(n),t=_(t);var e=t.indexOf(void 0);return e>-1&&t.splice(e,1),t}function g(t,n){return t=f(t).slice(f(n).length),t=t.split("/"),""===t[0]&&t.shift(),t}function m(t,n){var e=[],r=[];return n.forEach(function(n,i){n===t[i]?e.push(n):r.push(n)}),r.length>0&&(r=d(r)),r}function y(t,n){return t=l(t),t[0]===n&&t.shift(),t}var v={toArray:l,camelize:r,extendPath:p,flatten:_,removeSlash:f,stringify:d,pluralize:o,relativePath:h,qWrap:s,qAll:u,qAllResult:a,singularize:i,paramNodeIdx:y,nodeIdx:g,nextPath:m,standardError:c};return v}angular.module("firebase.fuel").factory("utils",t),t.$inject=["$log","$q","inflector"]}(),function(){"use strict";function t(t){function n(n){t.info(n)}return{info:n}}t.$inject=["$log"],angular.module("firebase.fuel").factory("logger",t)}(),function(){"use strict";function t(t){t.debugEnabled(!0)}angular.module("firebase.fuel").config(t),t.$inject=["$logProvider"]}(),function(){"use strict";function t(t,e,r,i,o,s){return function(u,a){var c=new n(t,e,r,i,o,s,u,a);return c.construct()}}var n;angular.module("firebase.fuel").factory("fuel",t),t.$inject=["$timeout","utils","firePath","$q","$log","$injector"],n=function(t,n,e,r,i,o,s,u){if(this._timeout=t,this._utils=n,this._firePath=e,this._q=r,this._log=i,this._injector=o,this._path=s,this._options=u,this._nestedArrays=[],this._pathOptions={},this._options){if(this._gps=!1||this._options.gps,this._geofire=!1||this._options.geofire,this._options.nestedArrays){if(!Array.isArray(this._options.nestedArrays))throw new Error("Nested Arrays argument must be an array");this._nestedArrays=this._options.nestedArrays}this._gps===!0&&(this._locationObject=this._injector.get("location"),this._geofireObject=this._injector.get("geofire")),(this._gps===!0||this._geofire===!0)&&(this._pathOptions.geofire=!0,this._locationName="locations",this._geofireName="geofire",this._pathOptions.locationName=this._locationName,this._pathOptions.geofireName=this._geofireName),this._user=this._options.user||!1,this._sessionAccess=this._options.sessionAccess||!1,this._user===!0&&(this._userPath="users",this._userObject=this._injector.get("user"),this._sessionAccess=!0),this._sessionAccess===!0&&(this._pathOptions.sessionAccess=!0,this._options.sessionLocation?this._sessionStorage=this._injector.get(this._options.sessionLocation):(this._sessionName="session",this._pathOptions.sessionLocation=this._sessionName,this._sessionStorage=this._injector.get(this._sessionName)),this._sessionIdMethod=this._options.sessionIdMethod?this._options.sessionIdMethod:"getId",this._pathOptions.sessionIdMethod=this._sessionIdMethod)}this._pathMaster=this._firePath(this._path,this._pathOptions)},n.prototype={construct:function(){function t(){return X._pathMaster.path()}function n(){return X._pathMaster.ref()}function e(){return X._pathMaster.parent()}function r(){return X._pathMaster.base()}function i(){return X._pathMaster.pathHistory()}function o(){return X._pathMaster.mainArray()}function s(t){return X._pathMaster.mainRecord(t)}function u(t,n){return X._pathMaster.nestedArray(t,n)}function a(t,n){return X._pathMaster.nestedRef(t,n)}function c(t,n,e){return X._pathMaster.indexAf(t,n,e)}function h(t,n,e){return X._pathMaster.nestedRecord(t,n,e)}function f(t){return X._pathMaster.makeGeo(t)}function _(t){return angular.isUndefined(t)?l():d(t)}function l(){return o().then(F).then(W)["catch"](Q)}function d(t){return s(t).then(F).then(W)["catch"](Q)}function p(){function t(t){return X._q.all(t.map(function(t){return _(t)}))}return X._userObject.getIndexKeys(P(),X._path).then(t)["catch"](Q)}function g(t,n,e){return n===!0&&t.geo&&delete t.geo,e===!0&&(t.uid=P()),J(o(),t).then(U).then(T)["catch"](Q)}function m(t){function n(n){return angular.isString(n)?s(t).then(H):H(t)}return n(t).then(T)["catch"](Q)}function y(t){function n(n){return angular.isString(n)?s(t).then(B):B(t)}return n(t).then(T)["catch"](Q)}function v(t,n){return X._geofireObject.set(X._path,t,n)}function A(t){return X._geofireObject.remove(X._path,t)}function b(t,n){return h(t,n).then(H).then(T)["catch"](Q)}function j(t,n){return J(u(t),n).then(U).then(T)["catch"](Q)}function w(t,n,e){function r(t){return t[0].set(t[1][0],t[1][1])}return J(f(t),[n,e]).then(r).then(T)["catch"](Q)}function $(t,n){function e(t){return t[0].get(t[1])}return J(f(t),n).then(e).then(W)["catch"](Q)}function M(t,n){function e(t){return X._log.info(t),t[0].remove(t[1])}return J(f(t),n).then(e).then(T)["catch"](Q)}function I(t){function n(t){return J(v(t[0].key(),t[1]),t[0])}var e={lat:t.lat,lon:t.lon};return J(X._locationObject.addLoc(X._path,t),[e.lat,e.lon]).then(n)["catch"](Q)}function x(t){function n(t){return J(A(t.key()),t)}return X._locationObject.removeLoc(t).then(n)["catch"](Q)}function R(t){return X._userObject.addIndex(P(),X._path,t)}function O(t){return X._userObject.removeIndex(P(),X._path,t)}function N(){return X._sessionStorage}function P(){return X._sessionStorage[X._sessionIdMethod]()}function q(t,n,e){function r(t){return J(R(t.key()),t)}return g(t,n,e).then(r)["catch"](Q)}function S(t){function n(t){return J(O(t.key()),t)}return m(t).then(n)["catch"](Q)}function z(t,n){function e(t){return J(Y(t[0][1].key(),X._locationName,t[1][1].key()),t[0][1])}function r(t){return t[1]}return X._q.all([q(t,null,!0),I(n,!0)]).then(e).then(r).then(T)["catch"](Q)}function L(t){function n(t){function n(t){return X._q.all(t.map(function(t){return x(t)}))}return K(t,X._locationName).then(n)}function e(t){return S(t[1])}return J(n(t),t).then(e)["catch"](Q)}function E(t,n){var e={};return X._q.all(n.map(function(n){angular.extend(e,k(t,n))})),angular.merge({},t,e)}function k(t,n){var e,r,i,o,s,a,c,f,_;return e=X._utils.pluralize(n),r=X._utils.singularize(n),i="add"+X._utils.camelize(r,!0),o="get"+X._utils.camelize(r,!0),s="remove"+X._utils.camelize(r,!0),a="load"+X._utils.camelize(r,!0),c="load"+X._utils.camelize(e,!0),f="save"+X._utils.camelize(r,!0),_={},_[e]=function(t){return u(t,e)},_[r]=function(t,n){return h(t,e,n)},_[i]=function(t,n){return J(_[e](t),n).then(U).then(T)["catch"](Q)},_[o]=function(t,n){return J(_[e](t),n).then(C).then(W)["catch"](Q)},_[s]=function(t,n){return _[r](t,n).then(H).then(T)["catch"](Q)},_[a]=function(t,n){return _[r](t,n).then(F).then(W)["catch"](Q)},_[c]=function(t){return _[e](t).then(F).then(W)["catch"](Q)},_[f]=function(t,n){return J(_[e](t),n).then(B).then(T)["catch"](Q)},_}function U(t){return t[0].$add(t[1])}function H(t){return Array.isArray(t)?t[0].$remove(t[1]):t.$remove()}function B(t){return Array.isArray(t)?t[0].$save(t[1]):t.$save()}function C(t){return t[0].$getRecord(t[1])}function F(t){return t.$loaded()}function Y(t,n,e){function r(t){return X._timeout(function(){var n={};return n[t[1]]=!0,t[0].update(n)}).then(function(){return t[0]})["catch"](Q)}return J(a(t,n),e).then(r)["catch"](Q)}function G(t,n,e){function r(t){return X._timeout(function(){var n={};return n[t[1]]=null,t[0].update(n)}).then(function(){return t[0]})["catch"](Q)}return J(a(t,n),e).then(r)["catch"](Q)}function K(t,n){function e(t){return J(t.$loaded(),[])}function r(t){return X._q.all(t[0].map(function(n){t[1].push(n.$id)})),t[1]}return c(t,n,"array").then(e).then(r)["catch"](Q)}function D(){function t(t){return t.orderByChild("uid").once("value",function(t){return t.val()})}return X._timeout(function(){return X._pathMaster.mainRef().then(t)["catch"](Q)})}function T(t){return X._log.info("command success"),X._pathMaster.setCurrentRef(t),t}function W(t){return X._log.info("query success"),X._log.info(t.$ref().key()),X._pathMaster.setCurrentRef(t.$ref()),t}function J(t,n){return X._utils.qAll(t,n)}function Q(t){return X._utils.standardError(t)}function V(){return X}var X=this,Z={};switch(Z.base=r,Z.ref=n,Z.path=t,Z.parent=e,Z.pathHistory=i,Z.inspect=V,Z.addIndex=Y,Z.removeIndex=G,Z.getIndexKeys=K,Z.load=_,Z.userRecordsByUID=D,Z.getRecord=C,Z.save=y,X._user!==!0&&X._gps!==!0&&(Z.add=g,Z.remove=m),X._user===!0&&X._gps!==!0&&(Z.loadUserRecords=p,Z.add=q,Z.remove=S),X._user===!0&&X._gps===!0&&(Z.add=z,Z.remove=L,Z.loadUserRecords=p),X._sessionAccess===!0&&(Z.session=N,Z.sessionId=P),X._geofire===!0&&(Z.get=$,Z.remove=M,Z.set=w,Z.addLoc=j,Z.removeLoc=b),n(),X._nestedArrays){case[]:break;default:return E(Z,X._nestedArrays)}return X._entity=Z,X._entity}}}.call(this),function(){"use strict";function t(t,e,r,i,o,s){return function(u,a,c){var h=new n(t,e,r,i,o,s,u,a,c);return h.construct()}}var n;angular.module("firebase.fuel").factory("firePath",t),t.$inject=["utils","$window","$q","$log","$injector","fireStarter"],n=function(t,n,e,r,i,o,s,u,a){if(this._utils=t,this._window=n,this._q=e,this._log=r,this._injector=i,this._path=s,this._fireStarter=o,this._options=u||null,this._constant=a||"FBURL",this._rootPath=this._injector.get(this._constant),!angular.isString(this._rootPath))throw new Error("You must provide a root path, either by a constant 'FBURL' or by providing a service name to inject");if(this._const=void 0,"FBURL"!==this._constant&&(this._const=this._constant),this._sessionAccess=!1,this._geofire=!1,this._options){if(this._options.sessionAccess===!0){if(this._sessionAccess=!0,!this._options.sessionLocation)throw new Error("You must provide a service to inject to access your session");if(this._sessionStorage=this._injector.get(this._options.sessionLocation),!this._options.sessionIdMethod)throw new Error("You must provide a method to query the sessionId");this._sessionIdMethod=this._options.sessionIdMethod}this._options.geofire===!0&&(this._geofire=!0,this._locationName=this._options.locationName||"locations",this._geofireName=this._options.geofireName||"geofire")}},n.prototype={construct:function(){function t(t,r){switch(n(t)){case!1:throw new Error("You cannot switch to a new main node");case!0:switch(r){case void 0:return e(t);default:return i(r,e(t),!0)}}}function n(t){return z(t).search(p())>-1}function e(t){switch(S(t)<0){case!0:return M(b().child(P(t)));case!1:return M(r(S(t)))}}function r(t){var n=b();switch(E._log.info("setting parent at index: "+t),t){case 0:return n;case 1:return n.parent();case 2:return n.parent().parent();case 3:return n.parent().parent().parent();case 4:return n.parent().parent().parent().parent();case 5:return n.parent().parent().parent().parent().parent();default:throw new Error("Too deep")}}function i(t,n,e){function r(t){return $(t),t}return E._q.when(E._fireStarter(t,n,e,E._const)).then(r)["catch"](R)}function o(){return new E._window.Firebase(d())}function s(){return o().child(E._utils.relativePath(E._path))}function u(n,e){return t(y(n,e))}function a(){return t(E._path,"array")}function c(n){return t(m(n),"object")}function h(n,e){return t(y(n,e),"array")}function f(n,e,r){return t(v(n,e,r),"object")}function _(n,e,r){return t(y(n,e),r)}function l(n){return t(E._utils.toArray([E._path,n]),"geo")}function d(){return E._utils.removeSlash(E._rootPath)}function p(){return s().toString()}function g(){return E._utils.toArray(E._path)}function m(t){return E._utils.extendPath(g(),t)}function y(t,n){return E._utils.extendPath(m(t),n)}function v(t,n,e){return E._utils.extendPath(y(t,n),e)}function A(){return b()?b().toString():void 0}function b(){return k._ref}function j(){return k._ref.parent()}function w(){return k._base}function $(t){return k._base=t,k._base}function M(t){return k._ref=t,I(t.toString()),k._ref}function I(t){return angular.isString(k._path)&&x(k._path),k._path=t,k._path}function x(t){k._pathHistory.push(t)}function R(t){return E._utils.standardError(t)}function O(){return k._pathHistory}function N(){return E._utils.nodeIdx(A(),p())}function P(t){return E._utils.nextPath(N(),q(t))}function q(t){return E._utils.paramNodeIdx(t,E._path)}function S(t){return N().length-q(t).length}function z(t){return d()+E._utils.relativePath(t)}function L(){return E}var E=this,k={};return k.main=s,k.nestedRef=u,k.rootRef=o,k.mainArray=a,k.mainRecord=c,k.nestedArray=h,k.nestedRecord=f,k.indexAf=_,k.build=t,k._pathHistory=[],k.base=w,k.ref=b,k.path=A,k.parent=j,k.pathHistory=O,k.nextRef=e,k.setCurrentRef=M,k.inspect=L,E._geofire===!0&&(k.makeGeo=l),M(s()),E._fire=k,E._fire}}}.call(this);