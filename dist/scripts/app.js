!function(){"use strict";angular.module("firebase.fuel",["platanus.inflector","firebase.starter"])}(),function(){"use strict";function t(t,n,e){function r(t){switch(angular.isString(t)){case!0:switch(t.length<20){case!0:return t;case!1:return u(t)}case!1:return s(t)}}function i(t){switch(Array.isArray(t)){case!0:return t;case!1:return s(t)}}function o(t){var n=[!1,!0];switch(n.indexOf(t)){case-1:return s(t);default:return t}}function s(t){throw new Error("Invalid parameter type at: "+t)}function u(t){throw new Error("Invalid parameter length at: "+t)}function a(t,n,e){switch(angular.isUndefined(t)){case!0:return e;case!1:switch(n){case"bool":return o(t);case"str":return r(t);case"arr":return i(t);case"opt":return c(t)}}}function c(t){return t}function h(t,n){return e.camelize(t,n)}function f(t){return e.singularize(t)}function _(t){return e.pluralize(t)}function l(t){return n.when(t)}function d(t,e){return n.all([t,l(e)])}function p(n){return n.length?(t.info("flattening results"),y(n)):n}function g(t){return n.reject(t)}function m(t){return b(w(v(t)))}function v(t){return"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),"/"===t[0]&&(t=t.substring(1)),t}function y(t){var n=t.reduce(function(t,n){return t.concat(n)},[]);return n}function w(t){return Array.isArray(t)?y(t):j([],t)}function b(t){return Array.isArray(t)&&(t=t.join("/")),t}function j(t,n){t.push(n),t=y(t);var e=t.indexOf(void 0);return e>-1&&t.splice(e,1),t}function $(t,n){return t=v(t).slice(v(n).length),t=t.split("/"),""===t[0]&&t.shift(),t}function k(t,n){var e=[],r=[];return n.forEach(function(n,i){n===t[i]?e.push(n):r.push(n)}),r.length>0&&(r=b(r)),r}function S(t,n){return t=w(t),t[0]===n&&t.shift(),t}var M={toArray:w,camelize:h,extendPath:j,flatten:y,removeSlash:v,stringify:b,pluralize:_,relativePath:m,qWrap:l,qAll:d,qAllResult:p,singularize:f,paramCheck:a,paramNodeIdx:S,nodeIdx:$,nextPath:k,standardError:g};return M}angular.module("firebase.fuel").factory("utils",t),t.$inject=["$log","$q","inflector"]}(),function(){"use strict";function t(t){function n(n){t.info(n)}return{info:n}}t.$inject=["$log"],angular.module("firebase.fuel").factory("logger",t)}(),function(){"use strict";function t(t){t.debugEnabled(!0)}angular.module("firebase.fuel").config(t),t.$inject=["$logProvider"]}(),function(){"use strict";function t(t,e,r,i,o,s){return function(u,a){var c=new n(t,e,r,i,o,s,u,a);return c.construct()}}var n;angular.module("firebase.fuel").factory("fuel",t),t.$inject=["$timeout","utils","firePath","$q","$log","$injector"],n=function(t,n,e,r,i,o,s,u){this._timeout=t,this._utils=n,this._firePath=e,this._q=r,this._log=i,this._injector=o,this._path=s,this._options=this._utils.paramCheck(u,"opt",{}),this._pathOptions={},this._constant=this._utils.paramCheck(this._options.constant,"str","FBURL"),this._geofire=this._utils.paramCheck(this._options.geofire,"bool",!1),this._gps=this._utils.paramCheck(this._options.gps,"bool",!1),this._nestedArrays=this._utils.paramCheck(this._options.nestedArrays,"arr",[]),this._session=this._utils.paramCheck(this._options.session,"bool",!1),this._user=this._utils.paramCheck(this._options.user,"bool",!1),(this._gps===!0||this._geofire===!0)&&(this._locationNode=this._utils.paramCheck(this._options.locationNode,"str","locations"),this._geofireNode=this._utils.paramCheck(this._options.geofireNode,"str","geofire"),this._latitude=this._utils.paramCheck(this._options.latitude,"str","lat"),this._longitude=this._utils.paramCheck(this._options.longitude,"str","lon"),this._pathOptions.geofire=!0,this._pathOptions.locationNode=this._locationNode,this._pathOptions.geofireNode=this._geofireNode),this._gps===!0&&(this._locationService=this._utils.paramCheck(this._options.locationService,"str",this._utils.singularize(this._locationNode)),this._geofireService=this._utils.paramCheck(this._options.geofireService,"str","geofire"),this._locationObject=this._injector.get(this._locationService),this._geofireObject=this._injector.get(this._geofireService)),(this._user===!0||this._session===!0)&&(this._uid=this._utils.paramCheck(this._options.uid,"bool",!0),this._uidProperty=this._utils.paramCheck(this._options.uidProperty,"str","uid")),this._user===!0&&(this._userNode=this._utils.paramCheck(this._options.userNode,"str","users"),this._userService=this._utils.paramCheck(this._options.userService,"str",this._utils.singularize(this._userNode)),this._userObject=this._injector.get(this._userService),this._session=!0),this._session===!0&&(this._sessionService=this._utils.paramCheck(this._options.sessionService,"str","session"),this._sessionIdMethod=this._utils.paramCheck(this._options.sessionIdMethod,"str","getId"),this._sessionObject=this._injector.get(this._sessionService),this._pathOptions.session=!0,this._pathOptions.sessionService=this._sessionService,this._pathOptions.sessionIdMethod=this._sessionIdMethod),this._pathMaster=this._firePath(this._path,this._pathOptions,this._constant)},n.prototype={construct:function(){function t(){return ut._pathMaster.path()}function n(){return ut._pathMaster.ref()}function e(){return ut._pathMaster.parent()}function r(){return ut._pathMaster.base()}function i(){return ut._pathMaster.pathHistory()}function o(){return ut._pathMaster.mainArray()}function s(t){return ut._pathMaster.mainRecord(t)}function u(t,n){return ut._pathMaster.nestedArray(t,n)}function a(t,n){return ut._pathMaster.nestedRef(t,n)}function c(t,n,e){return ut._pathMaster.indexAf(t,n,e)}function h(t,n,e){return ut._pathMaster.nestedRecord(t,n,e)}function f(t){return ut._pathMaster.makeGeo(t)}function _(t){return angular.isUndefined(t)?l():d(t)}function l(){return o().then(V).then(rt)["catch"](ot)}function d(t){return s(t).then(V).then(rt)["catch"](ot)}function p(){function t(t){return ut._q.all(t.map(function(t){return _(t)}))}return ut._userObject.getIndexKeys(P(),ut._path).then(t)["catch"](ot)}function g(t){return it(l(),t).then(J).then(rt)["catch"](ot)}function m(t,n,e){switch(angular.isString(t)){case!0:return it(s(t),[n,e]).then(Q)["catch"](ot);case!1:return it(t,[n,e]).then(Q)["catch"](ot)}}function v(t,n,e){return e===!0&&(t[ut._uidProperty]=P()),it(o(),t).then(T).then(et)["catch"](ot)}function y(t){function n(n){return angular.isString(n)?s(t).then(D):D(t)}return n(t).then(et)["catch"](ot)}function w(t){return G(t).then(et)["catch"](ot)}function b(t,n){return ut._geofireObject.set(ut._path,t,n)}function j(t){return ut._geofireObject.remove(ut._path,t)}function $(t,n){return h(t,n).then(D).then(et)["catch"](ot)}function k(t,n,e){return e===!0&&(delete n[ut._latitude],delete n[ut._longitude]),it(u(t),n).then(T).then(et)["catch"](ot)}function S(t,n,e){function r(t){return t[0].set(t[1][0],t[1][1])}return it(f(t),[n,e]).then(r).then(et)["catch"](ot)}function M(t,n){function e(t){return it(t[0],t[0].query(t[1]))}return it(f(t),n).then(e).then(rt)["catch"](ot)}function C(t,n){function e(t){return it(t[0],t[0].get(t[1]))}return it(f(t),n).then(e).then(rt)["catch"](ot)}function A(t,n){function e(t){return ut._log.info(t),t[0].remove(t[1])}return it(f(t),n).then(e).then(et)["catch"](ot)}function O(t){function n(t){return it(b(t[0].key(),t[1]),t[0])}var e={lat:t[ut._latitude],lon:t[ut._longitude]};return it(ut._locationObject.addLoc(ut._path,t,!0),[e.lat,e.lon]).then(n)["catch"](ot)}function x(t){function n(t){return it(j(t.key()),t)}return ut._locationObject.removeLoc(t).then(n)["catch"](ot)}function I(t){return ut._userObject.addIndex(P(),ut._path,t)}function R(t){return ut._userObject.removeIndex(P(),ut._path,t)}function q(t,n){return m(P(),t,n)}function N(){return ut._sessionObject}function P(){return ut._sessionObject[ut._sessionIdMethod]()}function z(t,n,e){function r(t){return it(I(t.key()),t)}return e||(e=ut._uid),v(t,n,e).then(r)["catch"](ot)}function E(t){function n(t){return it(R(t.key()),t)}return y(t).then(n)["catch"](ot)}function B(t,n){function e(t){return it(X(t[0].key(),ut._locationNode,t[1][1].key()),t[0])}function r(t){return t[1]}return ut._q.all([v(t),O(n,!0)]).then(e).then(r).then(et)["catch"](ot)}function L(t){function n(t){function n(t){return ut._q.all(t.map(function(t){return x(t)}))}return tt(t,ut._locationNode).then(n)}function e(t){return y(t[1])}return it(n(t),t).then(e)["catch"](ot)}function U(t,n){function e(t){return it(X(t[0][1].key(),ut._locationNode,t[1][1].key()),t[0][1])}function r(t){return t[1]}return ut._q.all([z(t),O(n,!0)]).then(e).then(r).then(et)["catch"](ot)}function F(t){function n(t){function n(t){return ut._q.all(t.map(function(t){return x(t)}))}return tt(t,ut._locationNode).then(n)}function e(t){return E(t[1])}return it(n(t),t).then(e)["catch"](ot)}function H(t,n){var e={};return ut._q.all(n.map(function(n){angular.extend(e,Y(t,n))})),angular.merge({},t,e)}function Y(t,n){var e,r,i,o,s,a,c,f,_;return e=ut._utils.pluralize(n),r=ut._utils.singularize(n),i="add"+ut._utils.camelize(r,!0),o="get"+ut._utils.camelize(r,!0),s="remove"+ut._utils.camelize(r,!0),a="load"+ut._utils.camelize(r,!0),c="load"+ut._utils.camelize(e,!0),f="save"+ut._utils.camelize(r,!0),_={},_[e]=function(t){return ut._session!==!0||t||(t=P()),u(t,e)},_[r]=function(t,n){if(ut._session!==!0||n||(n=P()),t)return h(n,e,t);throw new Error("You must provide a record id")},_[i]=function(t,n){return it(_[e](n),t).then(T).then(et)["catch"](ot)},_[o]=function(t,n){return it(_[e](n),t).then(J).then(rt)["catch"](ot)},_[s]=function(t,n){return _[r](t,n).then(D).then(et)["catch"](ot)},_[a]=function(t,n){return _[r](t,n).then(V).then(rt)["catch"](ot)},_[c]=function(t){return _[e](t).then(V).then(rt)["catch"](ot)},_[f]=function(t){return w(t)},_}function T(t){return t[0].$add(t[1])}function D(t){return Array.isArray(t)?t[0].$remove(t[1]):t.$remove()}function G(t){switch(Array.isArray(t)){case!0:return K(t);case!1:return W(t)}}function K(t){function n(n){switch(angular.isString(n[1])){case!0:return it(n[0].$indexFor(n[1]),n[0]).then(e);case!1:return t[0].$save(t[1])}}function e(t){return t[1].$save(t[0])}return n(t)["catch"](ot)}function W(t){return t.$save()}function J(t){function n(t){return[t[1],t[0]]}return it(t[0].$getRecord(t[1]),t[0]).then(n)["catch"](ot)}function Q(t){return t[0].$bindTo(t[1][0],t[1][1])}function V(t){return t.$loaded()}function X(t,n,e){function r(t){return ut._timeout(function(){var n={};return n[t[1]]=!0,t[0].update(n)}).then(function(){return t[0]})["catch"](ot)}return it(a(t,n),e).then(r)["catch"](ot)}function Z(t,n,e){function r(t){return ut._timeout(function(){var n={};return n[t[1]]=null,t[0].update(n)}).then(function(){return t[0]})["catch"](ot)}return it(a(t,n),e).then(r)["catch"](ot)}function tt(t,n){function e(t){return it(t.$loaded(),[])}function r(t){return ut._q.all(t[0].map(function(n){t[1].push(n.$id)})),t[1]}return c(t,n,"array").then(e).then(r)["catch"](ot)}function nt(){function t(t){return t.orderByChild("uid").once("value",function(t){return t.val()})}return ut._timeout(function(){return ut._pathMaster.mainRef().then(t)["catch"](ot)})}function et(t){switch(ut._log.info("command success"),angular.isString(t.key())){case!0:return ut._pathMaster.setCurrentRef(t),t;default:throw ut._log.info(t),new Error("invalid command success")}}function rt(t){switch(ut._log.info("query success"),angular.isDefined(t.$ref)){case!0:return ut._log.info("setting ref to current object ref"),ut._pathMaster.setCurrentRef(t.$ref()),ut._pathMaster.setBase(t),t;case!1:switch(angular.isObject(t[1])){case!0:return ut._log.info(t),ut._log.info("setting ref to current parent"),ut._pathMaster.setCurrentRef(t[0].$ref()),ut._pathMaster.setBase(t[0]),t[1];case!1:return ut._log.info("return value is null"),ut._pathMaster.setCurrentRef(t[0].$ref()),ut._pathMaster.setBase(t[0]),t[0]}default:throw ut._log.info(t),new Error("invalid query success")}}function it(t,n){return ut._utils.qAll(t,n)}function ot(t){return ut._utils.standardError(t)}function st(t){return t?(t="_"+t,ut[t]):ut}var ut=this,at={};switch(at.base=r,at.ref=n,at.path=t,at.parent=e,at.pathHistory=i,at.inspect=st,at.load=_,at.getRecord=g,at.getIndexKeys=tt,at.bindTo=m,at.save=w,at.addIndex=X,at.removeIndex=Z,ut._user!==!0&&ut._gps!==!0&&(at.add=v,at.remove=y),ut._user===!0&&(at.loadUserRecords=p,at.userRecordsByUID=nt),ut._gps===!0&&(at.createLocation=O,at.removeLocation=x),ut._user!==!0&&ut._gps===!0&&(at.add=B,at.remove=L),ut._user===!0&&ut._gps!==!0&&(at.add=z,at.remove=E),ut._user===!0&&ut._gps===!0&&(at.add=U,at.remove=F),ut._session===!0&&(at.session=N,at.sessionId=P,at.bindCurrent=q),ut._geofire===!0&&(at.get=C,at.remove=A,at.set=S,at.query=M,at.addLoc=k,at.removeLoc=$),n(),ut._nestedArrays){case[]:break;default:return H(at,ut._nestedArrays)}return ut._entity=at,ut._entity}}}.call(this),function(){"use strict";function t(t,e,r,i,o,s){return function(u,a,c){var h=new n(t,e,r,i,o,s,u,a,c);return h.construct()}}var n;angular.module("firebase.fuel").factory("firePath",t),t.$inject=["utils","$window","$q","$log","$injector","fireStarter"],n=function(t,n,e,r,i,o,s,u,a){if(this._utils=t,this._window=n,this._q=e,this._log=r,this._injector=i,this._path=s,this._fireStarter=o,this._options=u||null,this._constant=a||"FBURL",this._rootPath=this._injector.get(this._constant),!angular.isString(this._rootPath))throw new Error("You must provide a root path, either by a constant 'FBURL' or by providing a service name to inject");if(this._const=void 0,"FBURL"!==this._constant&&(this._const=this._constant),this._session=!1,this._geofire=!1,this._options){if(this._options.session===!0){if(this._session=!0,!this._options.sessionService)throw new Error("You must provide a service to inject to access your session");if(this._sessionObject=this._injector.get(this._options.sessionService),!this._options.sessionIdMethod)throw new Error("You must provide a method to query the sessionId");this._sessionIdMethod=this._options.sessionIdMethod}this._options.geofire===!0&&(this._geofire=!0,this._locationNode=this._options.locationNode||"locations",this._geofireNode=this._options.geofireNode||"geofire")}},n.prototype={construct:function(){function t(t,r){switch(n(t)){case!1:throw new Error("You cannot switch to a new main node");case!0:switch(r){case void 0:return e(t);default:return i(r,e(t),!0)}}}function n(t){return N(t).search(p())>-1}function e(t){var n;switch(q(t)<0){case!0:n=S(b().child(I(t)));case!1:n=S(r(q(t)))}return n}function r(t){var n=b();switch(z._log.info("setting parent at index: "+t),t){case 0:return n;case 1:return n.parent();case 2:return n.parent().parent();case 3:return n.parent().parent().parent();case 4:return n.parent().parent().parent().parent();case 5:return n.parent().parent().parent().parent().parent();default:throw new Error("Too deep - construct again")}}function i(t,n,e){function r(t){return k(t),t}return z._q.when(z._fireStarter(t,n,e,z._const)).then(r)["catch"](A)}function o(){return new z._window.Firebase(d())}function s(){return o().child(z._utils.relativePath(z._path))}function u(n,e){return t(v(n,e))}function a(){return t(z._path,"array")}function c(n){return t(m(n),"object")}function h(n,e){return t(v(n,e),"array")}function f(n,e,r){return t(y(n,e,r),"object")}function _(n,e,r){return t(v(n,e),r)}function l(n){return t(z._utils.toArray([z._path,n]),"geo")}function d(){return z._utils.removeSlash(z._rootPath)}function p(){return s().toString()}function g(){return z._utils.toArray(z._path)}function m(t){return z._utils.extendPath(g(),t)}function v(t,n){return z._utils.extendPath(m(t),n)}function y(t,n,e){return z._utils.extendPath(v(t,n),e)}function w(){return b()?b().toString():void 0}function b(){return E._ref}function j(){return E._ref.parent()}function $(){return E._base}function k(t){return E._base=t,E._base}function S(t,n){return E._ref=t,M(t.toString()),n===!0&&k(null),E._ref}function M(t){return angular.isString(E._path)&&C(E._path),E._path=t,E._path}function C(t){E._pathHistory.push(t)}function A(t){return z._utils.standardError(t)}function O(){return E._pathHistory}function x(){return z._utils.nodeIdx(w(),p())}function I(t){return z._utils.nextPath(x(),R(t))}function R(t){return z._utils.paramNodeIdx(t,z._path)}function q(t){return x().length-R(t).length}function N(t){return z._utils.stringify([d(),z._utils.relativePath(t)])}function P(){return z}var z=this,E={};return E.main=s,E.nestedRef=u,E.rootRef=o,E.mainArray=a,E.mainRecord=c,E.nestedArray=h,E.nestedRecord=f,E.indexAf=_,E.build=t,E._pathHistory=[],E.base=$,E.setBase=k,E.ref=b,E.path=w,E.parent=j,E.pathHistory=O,E.nextRef=e,E.setCurrentRef=S,E.inspect=P,z._geofire===!0&&(E.makeGeo=l),S(s()),z._fire=E,z._fire}}}.call(this);