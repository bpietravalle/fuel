!function(){"use strict";angular.module("firebase.fuel",["platanus.inflector","firebase.starter"])}(),function(){"use strict";function t(t,n,e){function r(t,n){return e.camelize(t,n)}function i(t){return e.singularize(t)}function o(t){return e.pluralize(t)}function s(t){return n.when(t)}function u(t,e){return n.all([t,s(e)])}function c(n){return n.length?(t.info("flattening results"),f(n)):n}function a(t){return n.reject(t)}function h(t){return"/"===t[-1]&&(t=t.substring(0,-1)),"/"===t[0]&&(t=t.substring(1)),t}function f(t){var n=t.reduce(function(t,n){return t.concat(n)},[]);return n}function _(t){return Array.isArray(t)?f(t):d([],t)}function l(t){return Array.isArray(t)&&(t=t.join("/")),t}function d(t,n){return t.push(n),f(t)}var p={arrayify:_,camelize:r,extendPath:d,flatten:f,removeSlash:h,stringify:l,pluralize:o,qWrap:s,qAll:u,qAllResult:c,singularize:i,standardError:a};return p}angular.module("firebase.fuel").factory("utils",t),t.$inject=["$log","$q","inflector"]}(),function(){"use strict";function t(t){function n(n){t.info(n)}return{info:n}}t.$inject=["$log"],angular.module("firebase.fuel").factory("logger",t)}(),function(){"use strict";function t(t){t.debugEnabled(!0)}angular.module("firebase.fuel").config(t),t.$inject=["$logProvider"]}(),function(){"use strict";function t(t,e,r,i,o,s){return function(u,c){var a=new n(t,e,r,i,o,s,u,c);return a.construct()}}var n;angular.module("firebase.fuel").factory("fuel",t),t.$inject=["$timeout","utils","firePath","$q","$log","$injector"],n=function(t,n,e,r,i,o,s,u){if(this._timeout=t,this._utils=n,this._firePath=e,this._q=r,this._log=i,this._injector=o,this._path=s,this._options=u,this._nestedArrays=[],this._pathOptions={},this._options){if(this._gps=!1||this._options.gps,this._geofire=!1||this._options.geofire,this._options.nestedArrays){if(!Array.isArray(this._options.nestedArrays))throw new Error("Nested Arrays argument must be an array");this._nestedArrays=this._options.nestedArrays}this._gps===!0&&(this._locationObject=this._injector.get("location"),this._geofireObject=this._injector.get("geofire")),(this._gps===!0||this._geofire===!0)&&(this._pathOptions.geofire=!0,this._locationName="locations",this._geofireName="geofire",this._locationPath=[this._locationName,this._path],this._geofirePath=[this._geofireName,this._path],this._pathOptions.locationName=this._locationName,this._pathOptions.geofireName=this._geofireName),this._user=this._options.user||!1,this._sessionAccess=this._options.sessionAccess||!1,this._user===!0&&(this._userPath="users",this._userObject=this._injector.get("user"),this._sessionAccess=!0),this._sessionAccess===!0&&(this._pathOptions.sessionAccess=!0,this._pathOptions.userName=this._userPath,this._options.sessionLocation?this._sessionStorage=this._injector.get(this._options.sessionLocation):(this._sessionName="session",this._pathOptions.sessionLocation=this._sessionName,this._sessionStorage=this._injector.get(this._sessionName)),this._sessionIdMethod=this._options.sessionIdMethod?this._options.sessionIdMethod:"getId",this._pathOptions.sessionIdMethod=this._sessionIdMethod)}this._pathMaster=this._firePath(this._path,this._pathOptions)},n.prototype={construct:function(){function t(){return X._pathMaster.currentPath()}function n(){return X._pathMaster.currentRef()}function e(){return X._pathMaster.currentParentRef()}function r(){return X._pathMaster.currentBase()}function i(){return X._pathMaster.pathHistory()}function o(){return X._pathMaster.mainArray()}function s(t){return X._pathMaster.mainRecord(t)}function u(t,n){return X._pathMaster.nestedArray(t,n)}function c(t,n){return X._pathMaster.nestedRef(t,n)}function a(t,n,e){return X._pathMaster.indexAf(t,n,e)}function h(t,n,e){return X._pathMaster.nestedRecord(t,n,e)}function f(t){return X._pathMaster.makeGeo(t)}function _(t){return angular.isUndefined(t)?l():d(t)}function l(){return o().then(H).then(T)["catch"](Q)}function d(t){return s(t).then(H).then(T)["catch"](Q)}function p(){function t(t){return X._q.all(t.map(function(t){return _(t)}))}return X._userObject.getIndexKeys(O(),X._path).then(t)["catch"](Q)}function g(t,n,e){return n===!0&&t.geo&&delete t.geo,e===!0&&(t.uid=O()),W(o(),t).then(L).then(K)["catch"](Q)}function m(t){return s(t).then(U).then(K)["catch"](Q)}function y(t,n){return X._geofireObject.set(X._path,t,n)}function v(t){return X._geofireObject.remove(X._path,t)}function A(t,n){return h(t,n).then(U).then(K)["catch"](Q)}function R(t,n){return W(u(t),n).then(L).then(K)["catch"](Q)}function b(t,n,e){function r(t){return t[0].set(t[1][0],t[1][1])}return W(f(t),[n,e]).then(r).then(K)["catch"](Q)}function j(t,n){function e(t){return t[0].get(t[1])}return W(f(t),n).then(e).then(T)["catch"](Q)}function w(t,n){function e(t){return t[0].remove(t[1])}return W(f(t),n).then(e).then(K)["catch"](Q)}function P(t,n){function e(t){return W(y(t[0].key(),t[1]),t[0])}var r={lat:t.lat,lon:t.lon};return W(X._locationObject.addLoc(t,n),[r.lat,r.lon]).then(e)["catch"](Q)}function N(t){function n(t){return W(v(t.key()),t)}return X._locationObject.removeLoc(t).then(n)["catch"](Q)}function $(t,n){return F(t,X._locationName,n)["catch"](Q)}function M(t){return X._userObject.addIndex(O(),X._path,t)}function q(t){return X._userObject.removeIndex(O(),X._path,t)}function I(){return X._sessionStorage}function O(){return X._sessionStorage[X._sessionIdMethod]()}function S(t,n,e){function r(t){return W(M(t.key()),t)}return g(t,n,e).then(r)["catch"](Q)}function k(t){function n(t){return W(q(t.key()),t)}return m(t).then(n)["catch"](Q)}function x(t,n){function e(t){return W($(t[0][1].key(),t[1][1].key()),t[0][1])}function r(t){return t[1]}return X._q.all([S(t,null,!0),P(n,!0)]).then(e).then(r).then(K)["catch"](Q)}function z(t){function n(t){function n(t){return X._q.all(t.map(function(t){return N(t)}))}return G(t,X._locationName).then(n)}function e(t){return k(t[1])}return W(n(t),t).then(e)["catch"](Q)}function B(t,n){var e={};return X._q.all(n.map(function(n){angular.extend(e,E(t,n))})),angular.merge({},t,e)}function E(t,n){var e,r,i,o,s,c,a,f,_;return e=X._utils.pluralize(n),r=X._utils.singularize(n),i="add"+X._utils.camelize(r,!0),o="get"+X._utils.camelize(r,!0),s="remove"+X._utils.camelize(r,!0),c="load"+X._utils.camelize(r,!0),a="load"+X._utils.camelize(e,!0),f="save"+X._utils.camelize(r,!0),_={},_[e]=function(t){return u(t,e)},_[r]=function(t,n){return h(t,e,n)},_[i]=function(t,n){return W(_[e](t),n).then(L).then(K)["catch"](Q)},_[o]=function(t,n){return W(_[e](t),n).then(C).then(T)["catch"](Q)},_[s]=function(t,n){return _[r](t,n).then(U).then(K)["catch"](Q)},_[c]=function(t,n){return _[r](t,n).then(H).then(T)["catch"](Q)},_[a]=function(t){return _[e](t).then(H).then(T)["catch"](Q)},_[f]=function(t,n){return W(_[e](t),n).then(Y).then(K)["catch"](Q)},_}function L(t){return t[0].$add(t[1])}function U(t){return Array.isArray(t)?t[0].$remove(t[1]):t.$remove()}function Y(t){return Array.isArray(t)?t[0].$save(t[1]):t.$save()}function C(t){return t[0].$getRecord(t[1])}function H(t){return t.$loaded()}function F(t,n,e){function r(t){return X._timeout(function(){var n={};return n[t[1]]=!0,t[0].update(n)}).then(function(){return t[0]})["catch"](Q)}return W(c(t,n),e).then(r)["catch"](Q)}function D(t,n,e){function r(t){return X._timeout(function(){var n={};return n[t[1]]=null,t[0].update(n)}).then(function(){return t[0]})["catch"](Q)}return W(c(t,n),e).then(r)["catch"](Q)}function G(t,n){function e(t){return W(t.$loaded(),[])}function r(t){return X._q.all(t[0].map(function(n){t[1].push(n.$id)})),t[1]}return a(t,n,"ARRAY").then(e).then(r)["catch"](Q)}function J(){function t(t){return t.orderByChild("uid").once("value",function(t){return t.val()})}return X._timeout(function(){return X._pathMaster.mainRef().then(t)["catch"](Q)})}function K(t){return X._log.info("command success"),X._pathMaster.setCurrentRef(Array.isArray(t)?t[0]:t),t}function T(t){return X._log.info("query success"),X._pathMaster.setCurrentRef(t.$ref()),t}function W(t,n){return X._utils.qAll(t,n)}function Q(t){return X._utils.standardError(t)}function V(){return X}var X=this,Z={};switch(Z.currentBase=r,Z.currentRef=n,Z.currentPath=t,Z.currentParentRef=e,Z.pathHistory=i,Z.inspect=V,Z.addIndex=F,Z.removeIndex=D,Z.getIndexKeys=G,Z.load=_,Z.userRecordsByUID=J,X._user!==!0&&X._gps!==!0&&(Z.add=g,Z.save=Y,Z.remove=m),X._user!==!0&&X._gps===!0,X._user===!0&&X._gps!==!0&&(Z.loadUserRecords=p,Z.add=S,Z.remove=k),X._user===!0&&X._gps===!0&&(Z.add=x,Z.remove=z,Z.loadUserRecords=p),X._sessionAccess===!0&&(Z.session=I,Z.sessionId=O),X._geofire===!0&&(Z.get=j,Z.remove=w,Z.set=b,Z.addLoc=R,Z.removeLoc=A),n(),X._nestedArrays){case[]:break;default:return B(Z,X._nestedArrays)}return X._entity=Z,X._entity}}}.call(this),function(){"use strict";function t(t,e,r,i,o,s){return function(u,c,a){var h=new n(t,e,r,i,o,s,u,c,a);return h.construct()}}var n;angular.module("firebase.fuel").factory("firePath",t),t.$inject=["utils","$window","$q","$log","$injector","fireStarter"],n=function(t,n,e,r,i,o,s,u,c){if(this._utils=t,this._window=n,this._q=e,this._log=r,this._injector=i,this._path=s,this._fireStarter=o,this._options=u||null,this._constant=c||"FBURL",this._rootPath=this._injector.get(this._constant),!angular.isString(this._rootPath))throw new Error("You must provide a root path, either by a constant 'FBURL' or by providing a service name to inject");if(this._const=void 0,"FBURL"!==this._constant&&(this._const=this._constant),this._sessionAccess=!1,this._geofire=!1,this._options){if(this._options.sessionAccess===!0){if(this._sessionAccess=!0,!this._options.sessionLocation)throw new Error("You must provide a service to inject to access your session");if(this._sessionStorage=this._injector.get(this._options.sessionLocation),!this._options.sessionIdMethod)throw new Error("You must provide a method to query the sessionId");this._sessionIdMethod=this._options.sessionIdMethod,this._userName=this._options.userName?this._options.userName:"users"}this._options.geofire===!0&&(this._geofire=!0,this._locationName=this._options.locationName||"locations",this._geofireName=this._options.geofireName||"geofire")}},n.prototype={construct:function(){function t(t,e,i){function o(t){return e?n(e,t,!0):t}var s,u;switch(i){case!0:s=t;break;default:switch(u=T(t),x()){case void 0:V._log.info("setting new firebase node"),s=r(K(t));break;default:switch(u){case k():V._log.info("Reusing currentRef"),s=x();break;case B():V._log.info("Using currentParentRef"),s=z();break;default:O(u)?(V._log.info("Building childRef"),s=S(u)):(V._log.info("Setting new firebase node"),s=r(K(t)))}}}return U(s).then(o)["catch"](H)}function n(t,n,e){function r(t){return L(t),t}return V._q.when(V._fireStarter(t,n,e,V._const)).then(r)["catch"](H)}function e(){return new V._window.Firebase(l())}function r(t){return e().child(J(t))}function i(){return t(d(),"ARRAY")}function o(){return t(d())}function s(n){return t(p(n),"OBJECT")}function u(n,e){return t(g(n,e))}function c(n,e){return t(g(n,e),"ARRAY")}function a(n,e,r){return t(m(n,e,r),"OBJECT")}function h(n,e,r){return t(g(n,e),r)}function f(){return t(y())}function _(n){return t(v([V._path,n]),"geo")}function l(){return W(V._rootPath)}function d(){return G(V._path)}function p(t){return D(d(),t)}function g(t,n){return D(p(t),n)}function m(t,n,e){return D(g(t,n),e)}function y(){return G([V._userName,A(),V._path])}function v(t){return G(t)}function A(){return V._sessionStorage[V._sessionIdMethod]()}function R(){M();var t=k();return q(t)[q(t).length-1]}function b(){M();var t=k();return q(t)[1]}function j(){M();var t=k();return q(t)[q(t).length-2]}function w(){M();var t=k();return q(t).length}function P(){M();var t=k();return q(t)[2]}function N(){M();var t=k();return q(t)[3]}function $(t){M();var n=k();return I(n,t)}function M(){if(!k())throw new Error("You must define a current firebaseRef and path first")}function q(t){if(t.search(l())<0)throw new Error("you must pass an absolute path");return t.slice(l().length).split("/")}function I(t,n){return q(t).indexOf(n)}function O(t){var n;return n=t.substring(0,k().length),t.length>k().length?n===k():!1}function S(t){return x().child(W(t.slice(k().length)))}function k(){return x()?x().toString():void 0}function x(){return X._currentRef}function z(){return X._currentRef.parent()}function B(){return z()?z().toString():void 0}function E(){return X._currentBase}function L(t){return X._currentBase=t,X._currentBase}function U(t){function n(t){return Array.isArray(t)?V._q.when(t[0].$ref())["catch"](function(){V._q.reject("firebaseRef must be first item in the array")}):V._q.when(t)}function e(t){function n(n){return X._currentRef=t,Y(n),X._currentRef}return V._q.when(t.path).then(n)["catch"](function(){V._q.reject("argument is not a firebaseRef")})}return n(t).then(e)["catch"](H)}function Y(t){var n;return angular.isString(X._currentPath)&&C(X._currentPath),X._currentPath=n,X._currentPath}function C(t){X._pathHistory.push(t)}function H(t){return V._utils.standardError(t)}function F(){return X._pathHistory}function D(t,n){return V._utils.extendPath(t,n)}function G(t){return V._utils.arrayify(t)}function J(t){return V._utils.stringify(t)}function K(t){return J(G(W(t)))}function T(t){return l()+K(t)}function W(t){return V._utils.removeSlash(t)}function Q(){return V}var V=this,X={};return X.rootRef=e,X.mainRef=o,X.mainArray=i,X.mainRecord=s,X.nestedArray=c,X.nestedRecord=a,X.nestedRef=u,X.indexAf=h,X.checkPathParams=t,X.currentNode=R,X.currentParentNode=j,X.currentRecord=b,X.currentNestedArray=P,X.currentNestedRecord=N,X.currentNodeIdx=$,X._pathHistory=[],X.currentBase=E,X.currentRef=x,X.currentPath=k,X.currentParentRef=z,X.currentParentPath=B,X.pathHistory=F,X.currentDepth=w,X.setCurrentRef=U,X.inspect=Q,V._sessionAccess===!0&&(X.userIndex=f),V._geofire===!0&&(X.makeGeo=_),U(e()),V._fire=X,V._fire}}}.call(this);