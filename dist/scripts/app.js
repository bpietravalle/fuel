!function(){"use strict";angular.module("firebase.fuel",["platanus.inflector","firebase.starter"])}(),function(){"use strict";function t(t,e,n){function r(t){switch(angular.isString(t)){case!0:switch(t.length<100){case!0:return t;case!1:return u(t)}case!1:return s(t)}}function i(t){switch(Array.isArray(t)){case!0:return t;case!1:return s(t)}}function o(t){var e=[!1,!0];switch(e.indexOf(t)){case-1:return s(t);default:return t}}function s(t){throw new Error("Invalid parameter type at: "+t)}function u(t){throw new Error("Invalid parameter length at: "+t)}function a(t,e,n){switch(angular.isUndefined(t)){case!0:return n;case!1:switch(e){case"bool":return o(t);case"str":return r(t);case"arr":return i(t);case"opt":return c(t)}}}function c(t){return t}function h(t,e){return n.camelize(t,e)}function f(t){return n.singularize(t)}function _(t){return n.pluralize(t)}function l(t){return e.when(t)}function d(t,n){return e.all([t,l(n)])}function p(e){return e.length?(t.info("flattening results"),y(e)):e}function g(t){return e.reject(t)}function m(t){return w(b(v(t)))}function v(t){return"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),"/"===t[0]&&(t=t.substring(1)),t}function y(t){var e=t.reduce(function(t,e){return t.concat(e)},[]);return e}function b(t){return Array.isArray(t)?y(t):j([],t)}function w(t){return Array.isArray(t)&&(t=t.join("/")),t}function j(t,e){t.push(e),t=y(t);var n=t.indexOf(void 0);return n>-1&&t.splice(n,1),t}function $(t,e){return t=v(t).slice(v(e).length),t=t.split("/"),""===t[0]&&t.shift(),t}function k(t,e){var n=[],r=[];return e.forEach(function(e,i){e===t[i]?n.push(e):r.push(e)}),r.length>0&&(r=w(r)),r}function S(t,e){return t=b(t),t[0]===e&&t.shift(),t}var M={toArray:b,camelize:h,extendPath:j,flatten:y,removeSlash:v,stringify:w,pluralize:_,relativePath:m,qWrap:l,qAll:d,qAllResult:p,singularize:f,paramCheck:a,paramNodeIdx:S,nodeIdx:$,nextPath:k,standardError:g};return M}angular.module("firebase.fuel").factory("utils",t),t.$inject=["$log","$q","inflector"]}(),function(){"use strict";function t(t){function e(e){t.info(e)}return{info:e}}t.$inject=["$log"],angular.module("firebase.fuel").factory("logger",t)}(),function(){"use strict";function t(t){t.debugEnabled(!0)}angular.module("firebase.fuel").config(t),t.$inject=["$logProvider"]}(),function(){"use strict";function t(t){var n=this;n.rootRef,n.setRoot=function(e){n.rootRef=e,t.setRoot(n.rootRef)},n.$get=["$timeout","utils","firePath","$q","$log","$injector",function(t,n,r,i,o,s){return function(u,a){var c=new e(t,n,r,i,o,s,u,a);return c.construct()}}],e=function(t,e,r,i,o,s,u,a){this._timeout=t,this._utils=e,this._firePath=r,this._q=i,this._log=o,this._injector=s,this._path=u,this._rootPath=this._utils.paramCheck(n.rootRef,"str"),this._options=this._utils.paramCheck(a,"opt",{}),this._pathOptions={},this._pathOptions.rootPath=this._rootPath,this._geofire=this._utils.paramCheck(this._options.geofire,"bool",!1),this._gps=this._utils.paramCheck(this._options.gps,"bool",!1),this._nestedArrays=this._utils.paramCheck(this._options.nestedArrays,"arr",[]),this._session=this._utils.paramCheck(this._options.session,"bool",!1),this._user=this._utils.paramCheck(this._options.user,"bool",!1),(this._gps===!0||this._geofire===!0)&&(this._locationNode=this._utils.paramCheck(this._options.locationNode,"str","locations"),this._geofireNode=this._utils.paramCheck(this._options.geofireNode,"str","geofire"),this._latitude=this._utils.paramCheck(this._options.latitude,"str","lat"),this._longitude=this._utils.paramCheck(this._options.longitude,"str","lon"),this._pathOptions.geofire=!0,this._pathOptions.locationNode=this._locationNode,this._pathOptions.geofireNode=this._geofireNode),this._gps===!0&&(this._locationService=this._utils.paramCheck(this._options.locationService,"str",this._utils.singularize(this._locationNode)),this._geofireService=this._utils.paramCheck(this._options.geofireService,"str","geofire"),this._locationObject=this._injector.get(this._locationService),this._geofireObject=this._injector.get(this._geofireService)),(this._user===!0||this._session===!0)&&(this._uid=this._utils.paramCheck(this._options.uid,"bool",!0),this._uidProperty=this._utils.paramCheck(this._options.uidProperty,"str","uid")),this._user===!0&&(this._userNode=this._utils.paramCheck(this._options.userNode,"str","users"),this._userService=this._utils.paramCheck(this._options.userService,"str",this._utils.singularize(this._userNode)),this._userObject=this._injector.get(this._userService),this._session=!0),this._session===!0&&(this._sessionService=this._utils.paramCheck(this._options.sessionService,"str","session"),this._sessionIdMethod=this._utils.paramCheck(this._options.sessionIdMethod,"str","getId"),this._sessionObject=this._injector.get(this._sessionService),this._pathOptions.session=!0,this._pathOptions.sessionService=this._sessionService,this._pathOptions.sessionIdMethod=this._sessionIdMethod),this._pathMaster=this._firePath(this._path,this._pathOptions,this._constant)},e.prototype={construct:function(){function t(){return at._pathMaster.path()}function e(){return at._pathMaster.ref()}function n(){return at._pathMaster.parent()}function r(){return at._pathMaster.base()}function i(){return at._pathMaster.pathHistory()}function o(){return at._pathMaster.mainArray()}function s(t){return at._pathMaster.mainRecord(t)}function u(t,e){return at._pathMaster.nestedArray(t,e)}function a(t,e){return at._pathMaster.nestedRef(t,e)}function c(t,e,n){return at._pathMaster.indexAf(t,e,n)}function h(t,e,n){return at._pathMaster.nestedRecord(t,e,n)}function f(t){return at._pathMaster.makeGeo(t)}function _(t){return angular.isUndefined(t)?l():d(t)}function l(){return o().then(X).then(it)["catch"](st)}function d(t){return s(t).then(X).then(it)["catch"](st)}function p(){function t(t){return at._q.all(t.map(function(t){return _(t)}))}return at._userObject.getIndexKeys(z(),at._path).then(t)["catch"](st)}function g(t){return ot(l(),t).then(Q).then(it)["catch"](st)}function m(t,e,n){switch(angular.isString(t)){case!0:return ot(s(t),[e,n]).then(V)["catch"](st);case!1:return ot(t,[e,n]).then(V)["catch"](st)}}function v(t,e,n){return n===!0&&(t[at._uidProperty]=z()),ot(o(),t).then(F).then(rt)["catch"](st)}function y(t){function e(e){return angular.isString(e)?s(t).then(G):G(t)}return e(t).then(rt)["catch"](st)}function b(t){return K(t).then(rt)["catch"](st)}function w(t,e){return at._geofireObject.set(at._path,t,e)}function j(t){return at._geofireObject.remove(at._path,t)}function $(t,e){return h(t,e).then(G).then(rt)["catch"](st)}function k(t,e,n){return n===!0&&(delete e[at._latitude],delete e[at._longitude]),ot(u(t),e).then(F).then(rt)["catch"](st)}function S(t,e,n){function r(t){return t[0].set(t[1][0],t[1][1])}return ot(f(t),[e,n]).then(r).then(rt)["catch"](st)}function M(t,e){function n(t){return ot(t[0],t[0].query(t[1]))}return ot(f(t),e).then(n).then(it)["catch"](st)}function C(t,e){function n(t){return ot(t[0],t[0].get(t[1]))}return ot(f(t),e).then(n).then(it)["catch"](st)}function O(t,e){function n(t){return at._log.info(t),t[0].remove(t[1])}return ot(f(t),e).then(n).then(rt)["catch"](st)}function A(t){function e(t){return ot(w(t[0].key(),t[1]),t[0])}var n={lat:t[at._latitude],lon:t[at._longitude]};return ot(at._locationObject.addLoc(at._path,t,!0),[n.lat,n.lon]).then(e)["catch"](st)}function R(t){function e(t){return ot(j(t.key()),t)}return at._locationObject.removeLoc(t).then(e)["catch"](st)}function x(t){return at._userObject.addIndex(z(),at._path,t)}function I(t){return at._userObject.removeIndex(z(),at._path,t)}function P(t,e){return m(z(),t,e)}function q(){return s(z())}function N(){return at._sessionObject}function z(){return at._sessionObject[at._sessionIdMethod]()}function E(t,e,n){function r(t){return ot(x(t.key()),t)}return n||(n=at._uid),v(t,e,n).then(r)["catch"](st)}function B(t){function e(t){return ot(I(t.key()),t)}return y(t).then(e)["catch"](st)}function H(t,e){function n(t){return ot(Z(t[0].key(),at._locationNode,t[1][1].key()),t[0])}function r(t){return t[1]}return at._q.all([v(t),A(e,!0)]).then(n).then(r).then(rt)["catch"](st)}function L(t){function e(t){function e(t){return at._q.all(t.map(function(t){return R(t)}))}return et(t,at._locationNode).then(e)}function n(t){return y(t[1])}return ot(e(t),t).then(n)["catch"](st)}function U(t,e){function n(t){return ot(Z(t[0][1].key(),at._locationNode,t[1][1].key()),t[0][1])}function r(t){return t[1]}return at._q.all([E(t),A(e,!0)]).then(n).then(r).then(rt)["catch"](st)}function Y(t){function e(t){function e(t){return at._q.all(t.map(function(t){return R(t)}))}return et(t,at._locationNode).then(e)}function n(t){return B(t[1])}return ot(e(t),t).then(n)["catch"](st)}function T(t,e){var n={};return at._q.all(e.map(function(e){angular.extend(n,D(t,e))})),angular.merge({},t,n)}function D(t,e){var n,r,i,o,s,a,c,f,_;return n=at._utils.pluralize(e),r=at._utils.singularize(e),i="add"+at._utils.camelize(r,!0),o="get"+at._utils.camelize(r,!0),s="remove"+at._utils.camelize(r,!0),a="load"+at._utils.camelize(r,!0),c="load"+at._utils.camelize(n,!0),f="save"+at._utils.camelize(r,!0),_={},_[n]=function(t){return at._session!==!0||t||(t=z()),u(t,n)},_[r]=function(t,e){if(at._session!==!0||e||(e=z()),t)return h(e,n,t);throw new Error("You must provide a record id")},_[i]=function(t,e){return ot(_[n](e),t).then(F).then(rt)["catch"](st)},_[o]=function(t,e){return ot(_[n](e),t).then(Q).then(it)["catch"](st)},_[s]=function(t,e){return _[r](t,e).then(G).then(rt)["catch"](st)},_[a]=function(t,e){return _[r](t,e).then(X).then(it)["catch"](st)},_[c]=function(t){return _[n](t).then(X).then(it)["catch"](st)},_[f]=function(t){return b(t)},_}function F(t){return t[0].$add(t[1])}function G(t){return Array.isArray(t)?t[0].$remove(t[1]):t.$remove()}function K(t){switch(Array.isArray(t)){case!0:return W(t);case!1:return J(t)}}function W(t){function e(e){switch(angular.isString(e[1])){case!0:return ot(e[0].$indexFor(e[1]),e[0]).then(n);case!1:return t[0].$save(t[1])}}function n(t){return t[1].$save(t[0])}return e(t)["catch"](st)}function J(t){return t.$save()}function Q(t){function e(t){return[t[1],t[0]]}return ot(t[0].$getRecord(t[1]),t[0]).then(e)["catch"](st)}function V(t){return t[0].$bindTo(t[1][0],t[1][1])}function X(t){return t.$loaded()}function Z(t,e,n){function r(t){return at._timeout(function(){var e={};return e[t[1]]=!0,t[0].update(e)}).then(function(){return t[0]})["catch"](st)}return ot(a(t,e),n).then(r)["catch"](st)}function tt(t,e,n){function r(t){return at._timeout(function(){var e={};return e[t[1]]=null,t[0].update(e)}).then(function(){return t[0]})["catch"](st)}return ot(a(t,e),n).then(r)["catch"](st)}function et(t,e){function n(t){return ot(t.$loaded(),[])}function r(t){return at._q.all(t[0].map(function(e){t[1].push(e.$id)})),t[1]}return c(t,e,"array").then(n).then(r)["catch"](st)}function nt(){function t(t){return t.orderByChild("uid").once("value",function(t){return t.val()})}return at._timeout(function(){return at._pathMaster.mainRef().then(t)["catch"](st)})}function rt(t){switch(at._log.info("command success"),angular.isString(t.key())){case!0:return at._pathMaster.setCurrentRef(t),t;default:throw at._log.info(t),new Error("invalid command success")}}function it(t){switch(at._log.info("query success"),angular.isDefined(t.$ref)){case!0:return at._log.info("setting ref to current object ref"),at._pathMaster.setCurrentRef(t.$ref()),at._pathMaster.setBase(t),t;case!1:switch(angular.isObject(t[1])){case!0:return at._log.info(t),at._log.info("setting ref to current parent"),at._pathMaster.setCurrentRef(t[0].$ref()),at._pathMaster.setBase(t[0]),t[1];case!1:return at._log.info("return value is null"),at._pathMaster.setCurrentRef(t[0].$ref()),at._pathMaster.setBase(t[0]),t[0]}default:throw at._log.info(t),new Error("invalid query success")}}function ot(t,e){return at._utils.qAll(t,e)}function st(t){return at._utils.standardError(t)}function ut(t){return t?(t="_"+t,at[t]):at}var at=this,ct={};switch(ct.base=r,ct.ref=e,ct.path=t,ct.parent=n,ct.pathHistory=i,ct.inspect=ut,ct.load=_,ct.getRecord=g,ct.getIndexKeys=et,ct.bindTo=m,ct.save=b,ct.addIndex=Z,ct.removeIndex=tt,at._user!==!0&&at._gps!==!0&&(ct.add=v,ct.remove=y),at._user===!0&&(ct.loadUserRecords=p,ct.userRecordsByUID=nt),at._gps===!0&&(ct.createLocation=A,ct.removeLocation=R),at._user!==!0&&at._gps===!0&&(ct.add=H,ct.remove=L),at._user===!0&&at._gps!==!0&&(ct.add=E,ct.remove=B),at._user===!0&&at._gps===!0&&(ct.add=U,ct.remove=Y),at._session===!0&&(ct.bindCurrent=P,ct.current=q,ct.session=N,ct.sessionId=z),at._geofire===!0&&(ct.get=C,ct.remove=O,ct.set=S,ct.query=M,ct.addLoc=k,ct.removeLoc=$),e(),at._nestedArrays){case[]:break;default:return T(ct,at._nestedArrays)}return at._entity=ct,at._entity}}}var e;angular.module("firebase.fuel").provider("fuel",t),t.$inject=["fireStarterProvider"]}.call(this),function(){"use strict";function t(t,n,r,i,o,s){return function(u,a){var c=new e(t,n,r,i,o,s,u,a);return c.construct()}}var e;angular.module("firebase.fuel").factory("firePath",t),t.$inject=["utils","$window","$q","$log","$injector","fireStarter"],e=function(t,e,n,r,i,o,s,u){if(this._utils=t,this._window=e,this._q=n,this._log=r,this._injector=i,this._path=s,this._fireStarter=o,this._options=u,this._rootPath=this._options.rootPath,this._session=this._options.session,this._geofire=this._options.geofire,this._session===!0){if(this._sessionService=this._options.sessionService,this._sessionObject=this._injector.get(this._options.sessionService),!this._sessionObject)throw new Error("You must provide a service to inject to access your session");if(this._sessionIdMethod=this._options.sessionIdMethod,!this._sessionIdMethod)throw new Error("You must provide a method to query the sessionId")}this._geofire===!0&&(this._locationNode=this._options.locationNode,this._geofireNode=this._options.geofireNode)},e.prototype={construct:function(){function t(t,r){switch(e(t)){case!1:throw new Error("You cannot switch to a new main node");case!0:switch(r){case void 0:return n(t);default:return i(r,n(t),!0)}}}function e(t){return q(t).search(p())>-1}function n(t){var e;switch(P(t)<0){case!0:e=S(w().child(x(t)));case!1:e=S(r(P(t)))}return e}function r(t){var e=w();switch(z._log.info("setting parent at index: "+t),t){case 0:return e;case 1:return e.parent();case 2:return e.parent().parent();case 3:return e.parent().parent().parent();case 4:return e.parent().parent().parent().parent();case 5:return e.parent().parent().parent().parent().parent();default:throw new Error("Too deep - construct again")}}function i(t,e,n){function r(t){return k(t),t}return z._q.when(z._fireStarter(t,e,n)).then(r)["catch"](O)}function o(){return new z._window.Firebase(d())}function s(){return o().child(z._utils.relativePath(z._path))}function u(e,n){return t(v(e,n))}function a(){return t(z._path,"array")}function c(e){return t(m(e),"object")}function h(e,n){return t(v(e,n),"array")}function f(e,n,r){return t(y(e,n,r),"object")}function _(e,n,r){return t(v(e,n),r)}function l(e){return t(z._utils.toArray([z._path,e]),"geo")}function d(){return z._utils.removeSlash(z._rootPath)}function p(){return s().toString()}function g(){return z._utils.toArray(z._path)}function m(t){return z._utils.extendPath(g(),t)}function v(t,e){return z._utils.extendPath(m(t),e)}function y(t,e,n){return z._utils.extendPath(v(t,e),n)}function b(){return w()?w().toString():void 0}function w(){return E._ref}function j(){return E._ref.parent()}function $(){return E._base}function k(t){return E._base=t,E._base}function S(t,e){return E._ref=t,M(t.toString()),e===!0&&k(null),E._ref}function M(t){return angular.isString(E._path)&&C(E._path),E._path=t,E._path}function C(t){E._pathHistory.push(t)}function O(t){return z._utils.standardError(t)}function A(){return E._pathHistory}function R(){return z._utils.nodeIdx(b(),p())}function x(t){return z._utils.nextPath(R(),I(t))}function I(t){return z._utils.paramNodeIdx(t,z._path)}function P(t){return R().length-I(t).length}function q(t){return z._utils.stringify([d(),z._utils.relativePath(t)])}function N(){return z}var z=this,E={};return E.main=s,E.nestedRef=u,E.rootRef=o,E.mainArray=a,E.mainRecord=c,E.nestedArray=h,E.nestedRecord=f,E.indexAf=_,E.build=t,E._pathHistory=[],E.base=$,E.setBase=k,E.ref=w,E.path=b,E.parent=j,E.pathHistory=A,E.nextRef=n,E.setCurrentRef=S,E.inspect=N,z._geofire===!0&&(E.makeGeo=l),S(s()),z._fire=E,z._fire}}}.call(this);